define(["services/services"],function(e){e.service("Broker",["$rootScope","$q","$timeout","Player","Team",function(e,t,n,r,i){return{initialize:function(s){e.$bus.configuration.DEFAULT_CHANNEL="/",e.$bus.configuration.SYSTEM_CHANNEL="postal",e.$bus.configuration.promise.createDeferred=function(){return t.defer()},e.$bus.configuration.promise.getPromise=function(e){return e.promise},s.hasOwnProperty("logs")&&this.diagnostics(s.logs),n(function(){var t=e.$bus.channel("teams");_.each(i,function(e,n){t.subscribe("team."+n,e)});var n=e.$bus.channel("players");_.each(r,function(e,t){if(t=="promised")_.each(e,function(e,t){n.subscribe("player.promised."+t,e)});else if(t=="block")_.each(e,function(e,t){n.subscribe("player.block."+t,e)});else if(t=="all")_.each(e,function(e,t){n.subscribe("*."+t,e)});else if(_.isFunction(e))e.hasOwnProperty("self")?n.subscribe("player."+t,e.self):n.subscribe("player."+t,e);else{var r=n.subscribe("player."+t,e.self);_.each(e,function(e,t){switch(t){case"before":r.before(e);break;case"after":r.after(e);break;case"failed":r.catch(e)}})}}),console.log("players ->",e.$bus.subscriptions.players)})},diagnostics:function(t){e.logs={},_.each(t,function(t,n){_.isUndefined(e.logs[n])&&(e.logs[n]={}),e.logs[n].self=new e.$bus.diagnostics({name:n,filters:t,writer:function(t){_.isUndefined(e.logs[n].list)&&(e.logs[n].list=[]),e.logs[n].list.unshift(angular.extend(angular.fromJson(t),{fold:!1}))}})})}}}])});