define(["services/services"],function(e){e.factory("Players",["$rootScope","Store","$timeout",function(e,t,n){function i(e){return{userId:e,time:Date.now()}}var r=e.$bus.channel("players");r.subscribe({topic:"player.list",callback:function(e,n){var r=t.get();_.isUndefined(r)&&t.set([]),e.callback(r||[],n)}}),r.subscribe({topic:"player.save",callback:function(e){e.player.goals=_.isUndefined(e.player.goals)?0:e.player.goals;var n=t.get();if(e.player.id){var r=_.indexOf(n,_.find(n,function(t){return t.id==e.player.id}));n[r]=e.player}else n.push({id:Date.now(),name:e.player.name,position:e.player.position,goals:e.player.goals});t.set(n),e.callback(n)}}),r.subscribe({topic:"player.delete",callback:function(e){t.set(_.filter(t.get(),function(t){return t.id!=e.id})),e.callback(t.get())}}),r.subscribe({topic:"*.save",callback:function(){console.log("player save action!")}}),r.subscribe({channel:"players",topic:"*.delete",callback:function(){console.log("player delete action!")}}),r.subscribe("last.login",function(e,t){var r=i(e.userId);n(function(){t.reply({time:r.time,userId:e.userId})},4e3)})}])});